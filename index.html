<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Candidatos ‚Äî Distrito 7 (Epicentro/NBC)</title>
<style>
:root { color-scheme: light; }
* { box-sizing: border-box; }
body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#fff; color:#111; height:100vh; overflow:hidden; }
.wrap { max-width: 1100px; margin: 0 auto; height:100%; display:flex; flex-direction:column; }

/* --- ENCABEZADO FIJO Y SCROLL INTERNO --- */
.sticky-top {
  position: sticky;
  top: 0;
  background: #fff;
  z-index: 100;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.scroll-zone {
  flex:1;
  overflow-y: auto;
  padding-bottom: 40px;
}

/* Encabezado */
.header { display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:flex-end; padding:6px 0 10px; border-bottom:1px solid #eee; }
.header h1 { margin:0; font-size:22px; font-weight:900; }
.meta { font-size:12px; color:#6b7280; }
.hl { background:#FFD400; padding:6px 10px; border-radius:8px; font-weight:900; }

/* Banner distrito */
.district { border:1px solid #e5e7eb; border-radius:12px; overflow:hidden; margin-top:8px; }
.district-top { background:#005CA9; color:#fff; padding:14px 16px; display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
.district-name { font-size:18px; font-weight:900; }
.district-communes { font-size:12px; opacity:.95; }
.kpis { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; padding:12px; background:#f8fafc; border-top:1px solid #e5e7eb; }
.kpi { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px; display:flex; gap:10px; align-items:center; }
.kpi .dot { width:12px; height:12px; border-radius:50%; background:#005CA9; }
.kpi b { font-size:13px; display:block; color:#111; }
.kpi span { font-size:13px; color:#374151; }
.kpi a { color:#005CA9; font-weight:900; text-decoration:none; }
@media (max-width:800px){ .kpis{grid-template-columns:1fr;} }

/* Filtros */
.filters { 
  display:flex; flex-wrap:wrap; gap:8px; align-items:center;
  background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px;
  padding:10px 12px; margin:10px 0;
}
.filters select, .filters input {
  border:1px solid #d1d5db; border-radius:6px; padding:6px 8px;
  font-size:13px; background:#fff;
}
.btn { background:#005CA9; color:#fff; border:none; border-radius:6px; padding:6px 12px; font-size:13px; font-weight:600; cursor:pointer; }
.btn:hover { background:#004B8A; }
.btn-secondary { background:#6b7280; }
.btn-secondary:hover { background:#4b5563; }
.filters .count { margin-left:auto; font-size:12px; color:#6b7280; }

/* Lista */
.listbar { display:flex; align-items:center; gap:10px; padding:10px 12px; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:12px; margin:14px 0 8px; font-weight:900; color:#0f172a; }
.listdot { width:22px; height:22px; border-radius:50%; border:2px solid #e5e7eb; background:#fff; }

/* Grid tarjetas */
.grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; }
@media(max-width:900px){.grid{grid-template-columns:1fr;}}

/* Tarjetas */
.card { border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; background:#fff; }
.card-hd { padding:12px; border-bottom:1px solid #f1f5f9; display:flex; align-items:center; gap:12px; }
.img-wrap { position:relative; width:68px; height:68px; border-radius:50%; overflow:hidden; flex-shrink:0; background:#e5e7eb; }
.img-wrap img { width:100%; height:100%; object-fit:cover; display:block; user-drag:none; user-select:none; -webkit-user-drag:none; pointer-events:none; }
.img-wrap .blocker { position:absolute; inset:0; background:transparent; pointer-events:auto; cursor:default; }
.titlebox { display:flex; flex-direction:column; gap:6px; }
.name { font-weight:900; font-size:18px; }
.sub { font-size:12px; color:#475569; }
.badges { display:flex; gap:6px; flex-wrap:wrap; }
.badge { display:inline-block; padding:4px 8px; border-radius:999px; background:#e5e7eb; color:#111827; font-size:12px; font-weight:700; }
.badge.party { color:#fff; background:#005CA9; }
.badge.num { background:#FFD400; color:#111; font-weight:900; }

.card-bd { padding:12px; display:flex; flex-direction:column; gap:8px; }
.rowkv { display:grid; grid-template-columns:140px 1fr; gap:8px; align-items:center; font-size:14px; }
.k { color:#475569; }
.v { color:#111; font-weight:600; }
.desc { font-size:14px; color:#334155; line-height:1.45; background:#f8fafc; border:1px solid #e5e7eb; padding:10px; border-radius:10px; }

/* Redes sociales */
.card-ft { padding:10px 12px; border-top:1px solid #f1f5f9; display:flex; gap:10px; flex-wrap:wrap; }
.socials { display:flex; gap:8px; }
.socials a { text-decoration:none; display:inline-flex; align-items:center; justify-content:center; width:28px; height:28px; border-radius:50%; color:#fff; font-size:14px; }
.fb{background:#3b5998;} .x{background:#000;} .ig{background:#e4405f;} .tk{background:#010101;}

.footer { margin:14px 0 4px; font-size:12px; color:#6b7280; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap; }
</style>
</head>
<body>
<div class="wrap">
  <div class="sticky-top">
    <div class="header">
      <h1>Candidatos ‚Äî <span class="hl">Distrito 7</span></h1>
      <div class="meta" id="ts">‚Äî</div>
    </div>

    <section class="district">
      <div class="district-top">
        <div>
          <div class="district-name">Distrito 7</div>
          <div class="district-communes">
            Algarrobo, Cartagena, Casablanca, Conc√≥n, El Quisco, El Tabo, Isla de Pascua, Juan Fern√°ndez, San Antonio, Santo Domingo, Valpara√≠so y Vi√±a del Mar.
          </div>
        </div>
        <div class="hl">Elecciones 2025</div>
      </div>
      <div class="kpis">
        <div class="kpi"><div class="dot"></div><div><b>Electores</b><span> 842.134</span></div></div>
        <div class="kpi"><div class="dot"></div><div><b>Cargos a elegir</b><span> 8</span></div></div>
        <div class="kpi"><div class="dot"></div><div><b>Papeleta</b><span><a href="https://www.servel.cl/wp-content/uploads/2025/10/DIPUTADOS_07_05_REGION_DE_VALPARAISO.pdf" target="_blank" rel="noopener">Ver</a></span></div></div>
      </div>
    </section>

    <!-- Filtros -->
    <div class="filters">
      <select id="partyFilter"><option value="">Todos los partidos</option></select>
      <select id="sexFilter">
        <option value="">Todos los sexos</option>
        <option value="Hombre">Hombres</option>
        <option value="Mujer">Mujeres</option>
        <option value="Otro">Otro</option>
      </select>
      <input type="number" id="minAge" placeholder="Edad m√≠nima" min="0" style="width:120px;">
      <input type="number" id="maxAge" placeholder="Edad m√°xima" min="0" style="width:120px;">
      <button id="applyFilters" class="btn">Filtrar</button>
      <button id="resetFilters" class="btn btn-secondary">Reiniciar</button>
      <div class="count" id="visibleCount">‚Äî</div>
    </div>
  </div>

  <div class="scroll-zone">
    <div id="listsContainer"></div>
    <div class="footer">
      <div>Desarrollado por El Epicentro Labs</div>
      <div id="footstamp">‚Äî</div>
    </div>
  </div>
</div>

<script>
const DATA_URL="https://docs.google.com/spreadsheets/d/1mD4qQ9dnczdJ4lI8p8bd8TrPQICyXZjXcD9RxLePrLo/export?format=csv";

function stamp(){return new Date().toLocaleString("es-CL",{dateStyle:"medium",timeStyle:"short"});}
function setStamp(){document.getElementById('ts').textContent="Actualizado: "+stamp();document.getElementById('footstamp').textContent="Generado: "+stamp();}
function norm(s){return (s||"").replace(/["‚Äù‚Äú]/g,"").replace(/\s+/g," ").trim();}
function toIntAge(s){const m=String(s||"").match(/\d+/);return m?parseInt(m[0],10):NaN;}
function parseCSV(text){const lines=text.split(/\r?\n/).filter(l=>l.trim());const h=lines.shift().split(",").map(x=>x.trim().toLowerCase());
return lines.map(l=>{const c=l.split(","),o={};h.forEach((hh,i)=>o[hh]=c[i]?c[i].trim():"");return o;});}
function listHeaderHTML(n){return `<div class='listbar'><div class='listdot'></div>${n}</div><div class='grid' data-list='${n}'></div>`;}
function socials(r){const i=[];if(r.facebook)i.push(`<a href="${r.facebook}" target="_blank" class="fb" title="Facebook">f</a>`);if(r.x)i.push(`<a href="${r.x}" target="_blank" class="x" title="X">ùïè</a>`);if(r.instagram)i.push(`<a href="${r.instagram}" target="_blank" class="ig" title="Instagram">‚åæ</a>`);if(r.tiktok)i.push(`<a href="${r.tiktok}" target="_blank" class="tk" title="TikTok">‚ô™</a>`);return i.length?`<div class='socials'>${i.join("")}</div>`:"";}
function cardHTML(r){const img=r.photo?`<img src="${r.photo}" alt="${r.candidate}" onerror="this.style.display='none';this.parentNode.style.background='#e5e7eb';">`:"";const age=toIntAge(r.age);return `<article class='card' data-party="${norm(r.party)}" data-sex="${norm(r.sex)}" data-age="${isNaN(age)?'':age}">
<div class='card-hd'><div class='img-wrap no-ctx'>${img}<div class='blocker'></div></div><div class='titlebox'><div class='name'>${r.candidate||"‚Äî"}</div><div class='sub'>${r.party||""}</div><div class='badges'>${r.party?`<span class='badge party'>${r.party}</span>`:""}${r.cupo?`<span class='badge'>${r.cupo}</span>`:""}${r.number?`<span class='badge num'>${r.number}</span>`:""}</div></div></div>
<div class='card-bd'><div class='rowkv'><div class='k'>Edad</div><div class='v'>${r.age||"‚Äî"}</div></div><div class='rowkv'><div class='k'>Profesi√≥n</div><div class='v'>${r.profession||"‚Äî"}</div></div><div class='rowkv'><div class='k'>Distrito</div><div class='v'>${r.district||"‚Äî"}</div></div><div class='desc'>${r.bio||""}</div></div><div class='card-ft'>${socials(r)}</div></article>`;}
function isListHeaderRow(r){return norm(r.candidate||"").toLowerCase().startsWith("lista");}
function populatePartyFilter(rows){const sel=document.getElementById("partyFilter"),set=new Set();rows.forEach(r=>{if(!isListHeaderRow(r)&&r.party)set.add(norm(r.party));});[...set].sort().forEach(p=>{const o=document.createElement("option");o.value=p;o.textContent=p;sel.appendChild(o);});}
function updateVisibleCount(){const t=document.querySelectorAll('.card').length,v=[...document.querySelectorAll('.card')].filter(c=>c.style.display!=='none').length;document.getElementById('visibleCount').textContent=`${v}/${t} visibles`;}
function applyFilters(){const pf=norm(partyFilter.value),sf=norm(sexFilter.value),min=parseInt(minAge.value)||NaN,max=parseInt(maxAge.value)||NaN;document.querySelectorAll('.card').forEach(c=>{const p=norm(c.dataset.party),s=norm(c.dataset.sex),a=parseInt(c.dataset.age)||NaN;let ok=true;if(pf&&p!==pf)ok=false;if(sf&&s!==sf)ok=false;if(!isNaN(min)&&(!a||a<min))ok=false;if(!isNaN(max)&&(!a||a>max))ok=false;c.style.display=ok?"":"none";});document.querySelectorAll('[data-list]').forEach(g=>{const vis=[...g.children].some(x=>x.style.display!=='none');g.style.display=vis?"":"none";const b=g.previousElementSibling;if(b&&b.classList.contains('listbar'))b.style.display=vis?"":"none";});updateVisibleCount();}
function attachFilterEvents(){applyFilters();applyFiltersBtn.addEventListener('click',applyFilters);resetFilters.addEventListener('click',()=>{partyFilter.value='';sexFilter.value='';minAge.value='';maxAge.value='';applyFilters();});["partyFilter","sexFilter","minAge","maxAge"].forEach(id=>document.getElementById(id).addEventListener("input",applyFilters));}
async function load(){const res=await fetch(DATA_URL+"&t="+Date.now(),{cache:"no-store"});const csv=await res.text();const rows=parseCSV(csv);const cont=document.getElementById("listsContainer");cont.innerHTML="";let cur="";rows.forEach(r=>{if(isListHeaderRow(r)){cur=norm(r.candidate);cont.insertAdjacentHTML("beforeend",listHeaderHTML(cur));}else{const g=cont.querySelector(`[data-list='${cur}']`);if(g)g.insertAdjacentHTML("beforeend",cardHTML(r));}});document.addEventListener('contextmenu',e=>{if(e.target.closest('.img-wrap'))e.preventDefault();});populatePartyFilter(rows);attachFilterEvents();setStamp();}
load();
</script>
</body>
</html>

